CMAKE_MINIMUM_REQUIRED (VERSION 2.8.3)

SET (PROJECT_TOP_DIR ${CMAKE_CURRENT_LIST_DIR})

SET (CMAKE_C_COMPILER_WORKS 1)
SET (CMAKE_CXX_COMPILER_WORKS 1)

PROJECT (mycloud CXX C)

SET (EXECUTABLE_OUTPUT_PATH ${mycloud_BINARY_DIR}/bin)
SET (LIBRARY_OUTPUT_PATH    ${mycloud_BINARY_DIR}/lib)
SET (PLATFORM_SDK_PATH      ${mycloud_BINARY_DIR}/sdk)
SET (EXTERNAL_LIBS_PATH     ${mycloud_BINARY_DIR}/external)

SET (PRO_THIIRDPART_PATH    ${PROJECT_TOP_DIR}/thirdpart)
SET (PRO_SDK_PATH           ${PROJECT_TOP_DIR}/sdk)
SET (PRO_SCRIPT_PATH        ${PROJECT_TOP_DIR}/script)
SET (PRO_CONFIG_PATH        ${PROJECT_TOP_DIR}/configs/$ENV{PRODUCT_CONFIG})

SET (PLATFORM_HOME hybroad)

LIST (APPEND LIBS_DIRECTORIES
    ${LIBRARY_OUTPUT_PATH}
    )

LIST (APPEND INCLUDES ${mycloud_BINARY_DIR})

INCLUDE (${PRO_CONFIG_PATH}/CMakeLists.txt)
INCLUDE (${PRO_SDK_PATH}/CMakeLists.txt)
INCLUDE (${PRO_THIIRDPART_PATH}/CMakeLists.txt)
INCLUDE (${PLATFORM_HOME}/CMakeLists.txt)

EXECUTE_PROCESS(
    COMMAND ${PROJECT_TOP_DIR}/script/gen_build_info.sh "${mycloud_BINARY_DIR}"
    WORKING_DIRECTORY ${PROJECT_TOP_DIR}
    RESULT_VARIABLE GEN_BUIDL_INFO_RESULT
    )

ADD_CUSTOM_TARGET (images
    COMMAND exec "${PROJECT_TOP_DIR}/script/make_images.sh" "${PLATFORM_SDK_PATH}/rootfs" "${PLATFORM_CROSS_COMPILER}" "${PROJECT_TOP_DIR}"
    WORKING_DIRECTORY ${mycloud_BINARY_DIR}
    VERBATIM
    )
